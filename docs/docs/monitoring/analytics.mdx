---
id: analytics
sidebar_label: Analytics
title: Analytics
description:
abstract: Rasa Pro Analytics is a data pipeline that extracts model, training,
  and conversation data from the Rasa platform and streams the data to
  your data warehouse for analysis.
---

import useBaseUrl from "@docusaurus/useBaseUrl";
import RasaProLabel from "@theme/RasaProLabel";
import RasaProBanner from '@theme/RasaProBanner';

<RasaProLabel />

<RasaProBanner/>

Analytics helps visualize and process Rasa assistant metrics in the
tooling (BI tools, data warehouses) of your choice. Visualizations
and analysis of the production assistant and its conversations allow
you to assess ROI and improve the performance of the assistant over time.

<div align="center">
  <img
    alt="Rasa Pro Analytics example dashboard"
    src={useBaseUrl("/img/analytics/analytics-examples.png")}
    width="100%"
  />
</div>

Measuring a Rasa assistant's success and making strategic investments
will lead to better business outcomes. It will also help you understand
the needs of your end users and better serve them.

<div align="center">
  <img
    alt="An overview of the components of Rasa Pro."
    src={useBaseUrl("/img/rasa_pro_overview.png")}
    width="100%"
  />
</div>

Rasa Pro will connect to your production assistant using Kafka.
The pipeline will compute analytics as soon as the docker container is successfully
deployed and connected to your data warehouse and Kafka instances.

## Getting Started

### Prerequisites

- A production deployment of Kafka is required to set up Rasa Pro.
  We recommend using [Amazon Managed Streaming for
  Apache Kafka](https://aws.amazon.com/msk/).
- A production deployment of a data lake needs to be connected to
  the data pipeline. Rasa Pro supports the following data lakes:

  - [PostgreSQL](https://aws.amazon.com/rds/postgresql/) (**recommended**. All PostgreSQL >= 11.0 are supported)
  - [Amazon Redshift](https://aws.amazon.com/redshift/)

  We recommend managed deployments of your data lake to minimize maintenance
  efforts.

### Connect an assistant

The `<DATA_LAKE_URL>` should have a DBAPI format, e.g.
`postgresql+psycopg2://user:password@postgres.host:5432/rasa`.
If no data lake URL is configured, [Analytics](../monitoring/analytics.mdx)
will be disabled.

`RASA_ANALYTICS_DB_URL=<DATA_LAKE_URL>`

### Connect a data warehouse

#### PostgreSQL

TODO: general instructions.

TODO: instructions for AWS RDS

#### Redshift

TODO: streaming to Redshift from Postgres

TODO: direct connection with disclaimer on performance

### Ingest past conversations

When Analytics is connected to your Kafka instance, it will consume
all prior events on the Kafka topic and ingest them into the database.
Kafka has a retention policy for events on a [topic which defaults to
7 days](https://docs.confluent.io/platform/current/installation/configuration/topic-configs.html#topicconfigs_retention.ms).

If you want to process events from conversations that are older than the
retention policy configured for the Rasa topic, you can manually
ingest events from past conversations.

Manually ingesting data from past conversations requires a connection to the
tracker store. The tracker store contains past conversations and a
connection to the Kafka cluster. Use the `rasa export` command to export
the events stored in the tracker store to Kafka:

```shell
rasa export --endpoints endpoints.yml
```

Configure the export to read from your production tracker store
and write to Kafka as an event broker, e.g.

```yaml-rasa title="endpoints.yml"
  tracker_store:
      type: SQL
      dialect: "postgresql"
      url: "localhost"
      db: "tracker"
      username: postgres
      password: password

  event_broker:
      type: kafka
      topic: rasa-events
      url: localhost:29092
      partition_by_sender: true
```

:::note

Running manual ingestion of past events multiple times will result in
duplicated events. There is currently no deduplication implemented in
Analytics. Every ingested event will be stored in the database,
even if it was processed previously.
:::

### Connect a BI Solution

Connecting a business intelligence platform to the data warehouse varies for
each platform. We provide example instructions for Metabase and Tableau but
you can use any BI platform which supports AWS Redshift or PostgreSQL.

#### Example: Connecting Metabase

Metabase is a free and open-source business intelligence platform. It
provides a simple interface to query and visualize data. Metabase can
be connected to PostgreSQL or Redshift databases.

- [Connecting Metabase to PostgreSQL](https://www.metabase.com/data_sources/postgresql)
- [Connecting Metabase to Redshift](https://www.metabase.com/data_sources/amazon-redshift)

#### Example: Connecting Tableau

Tableau is a business intelligence platform. It provides a flexible interface
to build business intelligence dashboards. Tableau can be connected to
PostgreSQL or Redshift databases.

- [Connecting Tableau to PostgreSQL](https://help.tableau.com/current/pro/desktop/en-us/examples_postgresql.htm)
- [Connecting Tableau to Redshift](https://help.tableau.com/current/pro/desktop/en-us/examples_amazonredshift.htm)

## Example Queries

Inspiration on how to analyze the conversations your assistant is having. The
example queries are created using Metabase.

### Daily Chatbot Users

#### Query using SQL

```sql
SELECT CAST(rasa_sender.first_seen AS date) AS "Date", COUNT(*) AS "Number of Users"
FROM rasa_sender
GROUP BY CAST(rasa_sender.first_seen AS date)
ORDER BY CAST(rasa_sender.first_seen AS date) ASC
```

#### Using the Metabase Query Builder

<div align="center">
  <img
    alt="Example query for a query showcasing the number of users per day."
    src={useBaseUrl("/img/analytics/number-of-users-query.png")}
    width="100%"
  />
</div>

#### Result

<div align="center">
  <img
    alt="Example result for a query showcasing the number of users per day."
    src={useBaseUrl("/img/analytics/number-of-users-result.png")}
    width="100%"
  />
</div>

## Data Structure Reference

Descriptions and examples of the data structure created by Analytics.
The data structure is created by the Analytics pipeline and treated as
a public API.

Table overview:

<div align="center">
  <img
    alt="An overview of the components of Rasa Pro."
    src={useBaseUrl("/img/analytics/analytics-db-schema.png")}
    width="100%"
  />
</div>

Concepts / :

- **a sender**
- **a turn**
- **a session**

### rasa_session

The `rasa_session` table contains information about all conversation
sessions that users started with the assistant. New sessions are created
for every new user and for users who return to the assistant. The
conditions that trigger a new session to start can be
configured in the [Rasa Domain](./domain.mdx#session-configuration).

#### `id` session identifier

The unique identifier of the session. Every session gets a different,
generated id assigned.

Example: `63b150a6-21a3-4e6c-bb24-5ab6ddc30cf1`

#### `sender_id` sender who started the session

The unique identifier of the sender who started the session. It is a
foreign key to the [`rasa_sender.id`](#rasa_sender) column.

Example: `9e4ebded-f232-4cc5-af78-d98daa0c1a53`

#### `timestamp` creation date time

The timestamp when the session was created. The timestamp is a UTC.

Example: `2022-06-28 02:15:49.326936`

#### `start_sequence_number` start of the session

The sequence number of the first event in this session. All events belong
to exactly one session. The start sequence number is always smaller or equal
to the `end_sequence_number`. The difference between start and end sequence
numbers does not equal the number of events in this session since
sequence numbers are incremented across multiple conversations.

Example: `78`

#### `end_sequence_number` end of the session

The sequence number of the last event in the session.

Example: `91`

### rasa_event

The `rasa_event` table contains all events that an assistant created. Events
are created for every user message, bot response, and action that is executed
as well as for a lot of internal changes to a conversation session.
[Overview of all Rasa Events](./action-server/events.mdx).

#### `id` event identifier

The unique identifier of the event. Every event gets different,
generated id assigned.

Example: `f5adcd16-b18d-4c5c-95f0-1747b20cb0e6`

#### `sender_id` sender whose conversation the event belongs to

The unique identifier of the sender whose conversation this event is part of.
It is a foreign key to the [`rasa_sender.id`](#rasa_sender) column.

Example: `9e4ebded-f232-4cc5-af78-d98daa0c1a53`

#### `session_id` session identifier

The unique identifier of the session this event is part of.
It is a foreign key to the [`rasa_session.id`](#rasa_session) column.

Example: `63b150a6-21a3-4e6c-bb24-5ab6ddc30cf1`

#### `timestamp` creation date time

The timestamp when the event was created. The timestamp is a UTC.

Example: `2022-06-28 02:15:49.326936`

#### `event_type` kind of event

The type of the event. The event type is a string and can be one of the
following:

- `user`: The user sent a message to the assistant.
- `bot`: The assistant sent a message to the user.
- `action`: The assistant executed an action.
- `session_started`: A new session was started.
- `action_execution_rejected`: An action failed to execute.
- `active_loop`: The assistant is currently in a loop.
- `slot`: A slot was set.
- `followup`: A follow-up action was triggered.
- `loop_interrupted`: A loop was interrupted.
- `pause`: A session is paused, e.g. because the session was handed over
  to a human agent.
- `restart`: A session was restarted. This will trigger a new session to
  be started. The state of the assistant will be reset.
- `rewind`: The assistant rewinds to a previous state.
- `user_featurization`: The assistant featurized the user input.

Example: `action`

#### `model_id` model identifier

The identifier of the Rasa model that was running as part of the assistant
when this event was created.

Example: `75a985b7b86d442ca013d61ea4781b22`

#### `environment` name of the assistant environment

The name of the environment of the assistant that created this event.
The environment is a string that is set up during the start of the assistant,

Example: `production`

#### `sequence_number` start of the event

The sequence number of the event. The events of a session always have
increasing sequence numbers. Sequence numbers are not guaranteed to be
sequential for events following one another. But sequence numbers can
be used to order the events of a session.

Example: `78`

### rasa_sender

A sender is a user who interacts with the assistant through a Rasa Channel.
If the assistant supports more than one channel, a user might have multiple
senders. For example, a user might have a sender for the Facebook channel
and a sender for the Slack channel.

#### `id` sender identifier

The unique identifier of the sender is generated by Analytics. Sender
gets a different, generated id assigned. The `id` differs from the `sender_id`
used by the Rasa channels, the `sender_id` in Rasa is the
`sender_key` in Analytics.

Example: `a78783c4-bef7-4e55-9ec7-5afb4420f19a`

#### `sender_key` Rasa channel sender identifier

The unique identifier used by the Rasa channel to identify this sender. The
`sender_key` is specific to the channel implementation in Rasa and
the format depends on the channel.

Example: `fb26ba0a9d8b4bd99e2b8716acb19e4b`

#### `first_seen` first contact with this sender

The date and time of the first contact with this sender. Corresponds to the
time of the first event of the first session created for this sender.

Example: `2022-06-28 02:15:49.326936`

#### `last_seen` latest contact with this sender

The date and time of the last contact with this sender. Corresponds to the
time of the latest event of the latest session created for this sender.

Example: `2022-10-28 02:15:49.326936`

### rasa_bot_message

#### `id` bot message identifier

The unique identifier of the bot message is generated by Analytics.

Example: `2f2e5384-1bfa-4b53-90a7-c75e5f20b117`

#### `event_id` id of the event of this message

The unique identifier of the event that created this bot message.
It is a foreign key to the [`rasa_event.id`](#rasa_event) column.

Example: `f5adcd16-b18d-4c5c-95f0-1747b20cb0e6`

#### `sender_id` sender whose conversation the message belongs to

The unique identifier of the sender whose conversation this message is part of.
It is a foreign key to the [`rasa_sender.id`](#rasa_sender) column.

Example: `9e4ebded-f232-4cc5-af78-d98daa0c1a53`

#### `session_id` session identifier

The unique identifier of the session this message is part of.
It is a foreign key to the [`rasa_session.id`](#rasa_session) column.

Example: `63b150a6-21a3-4e6c-bb24-5ab6ddc30cf1`

#### `timestamp` creation date time

The timestamp when the message was created. The timestamp is a UTC.

Example: `2022-06-28 02:15:49.326936`

#### `model_id` model identifier

The identifier of the Rasa model that was running as part of the assistant
when this message was created.

Example: `75a985b7b86d442ca013d61ea4781b22`

#### `sequence_number` start of the event

The sequence number of the message. The events of a session always have
increasing sequence numbers. The sequence number of this message is the same
as the one of the underlying event.

Example: `78`

### rasa_user_message

### rasa_slot

### rasa_action

### rasa_session_slot_state

### rasa_turn

## Architecture

:::warning
check if there is a better title
:::
