import numpy as np

from rasa.nlu.tokenizers.mitie_tokenizer import MitieTokenizer
from rasa.nlu.config import RasaNLUModelConfig


def test_mitie_featurizer(mitie_feature_extractor, default_config):
    from rasa.nlu.featurizers.dense_featurizer.mitie_featurizer import MitieFeaturizer

    mitie_component_config = {"name": "MitieFeaturizer"}
    ftr = MitieFeaturizer.create(mitie_component_config, RasaNLUModelConfig())

    sentence = "Hey how are you today"

    mitie_component_config = {"name": "MitieTokenizer", "use_cls_token": False}
    tokens = MitieTokenizer(mitie_component_config).tokenize(sentence)

    vecs = ftr.features_for_tokens(tokens, mitie_feature_extractor)

    print(vecs[0])

    expected = np.array(
        [
            0.00000000e00,
            -5.12735510e00,
            4.39929873e-01,
            -5.60760403e00,
            -8.26445103e00,
            -2.82586724e-01,
            -1.00573087e00,
            6.16612673e00,
            4.51831198e00,
            -4.36631250e00,
            -4.30110741e00,
            1.45059049e00,
            -1.43656611e00,
            -2.57342124e00,
            4.97706032e00,
            8.10247707e00,
            -3.96101475e-01,
            7.00332284e-01,
            5.96706450e-01,
            -2.48464966e00,
            4.15551476e-02,
            -1.87830377e00,
            2.42095375e00,
            -5.44092357e-01,
            2.67223120e00,
            -2.00578022e00,
            1.22963965e00,
            2.41412973e00,
            -1.68471694e00,
            1.87547529e00,
            -6.68652773e-01,
            3.51532221e-01,
            -2.20869064e-01,
            -1.27275801e00,
            -4.55570340e-01,
            1.30415881e00,
            -7.04453290e-01,
            2.64976263e00,
            1.26680803e00,
            2.04671100e-01,
            2.10326767e00,
            -9.23435837e-02,
            -1.68740237e00,
            -1.97914347e-01,
            -1.41813803e00,
            -1.66212067e-01,
            -3.05680543e-01,
            -9.69038725e-01,
            9.14714634e-01,
            7.34257996e-01,
            -2.09392056e-01,
            1.55312046e-01,
            8.92380118e-01,
            -9.96749043e-01,
            4.89007890e-01,
            1.47573900e00,
            -1.83904159e00,
            -3.72725785e-01,
            2.75361121e-01,
            -5.25904536e-01,
            1.30387291e-01,
            7.00960279e-01,
            6.50017858e-01,
            -4.50371534e-01,
            -6.38834953e-01,
            6.73773468e-01,
            8.81396413e-01,
            -6.75141394e-01,
            4.86862332e-01,
            5.01379609e-01,
            4.88356948e-01,
            -4.53982174e-01,
            -7.30833590e-01,
            8.64133000e-01,
            -1.71588242e-01,
            6.58954322e-01,
            2.18044650e-02,
            7.73006380e-01,
            4.51285660e-01,
            -8.16508114e-01,
            1.95529416e-01,
            4.02571887e-01,
            3.07720363e-01,
            -1.18403830e-01,
            -1.73695073e-01,
            1.27457175e-02,
            4.45014611e-02,
            -2.24128217e-01,
            -1.06355086e-01,
            6.02598965e-01,
            -3.68196577e-01,
            -5.17653847e00,
            5.86267173e-01,
            -2.78645813e-01,
            -2.67106779e-02,
            2.77676725e00,
            2.26144981e00,
            -1.74828792e00,
            4.56249189e00,
            1.75182652e00,
            -4.38783467e-01,
            -1.09945142e00,
            -2.11774683e00,
            -2.76408410e00,
            -1.55349958e00,
            -3.79859638e00,
            3.96455169e00,
            -2.52921015e-01,
            -1.92639256e00,
            -4.89389300e-01,
            -4.02990580e00,
            -8.72295380e00,
            -1.46801007e00,
            -2.31932306e00,
            1.67305171e00,
            -3.19912529e00,
            1.86834311e00,
            2.06363127e-01,
            4.57791597e-01,
            -2.40873742e00,
            1.95506680e00,
            -3.92530274e00,
            -2.98407483e00,
            -1.78072822e00,
            1.29415095e00,
            1.00851856e-01,
            -1.08310506e-01,
            1.16931573e-01,
            1.38969958e00,
            -7.87991047e-01,
            -1.70851195e00,
            3.38014960e00,
            -2.66119748e-01,
            2.83784223e00,
            3.44787151e-01,
            1.87817657e00,
            7.69976914e-01,
            5.02131760e-01,
            1.00641572e00,
            2.05512595e00,
            8.01849067e-01,
            -8.64741862e-01,
            -2.41731501e00,
            -6.90070271e-01,
            8.99859846e-01,
            2.59272814e-01,
            2.12083149e00,
            1.71254003e00,
            2.31126094e00,
            1.05681944e00,
            -8.90498281e-01,
            5.30907393e-01,
            2.41127789e-01,
            -3.24536473e-01,
            -5.03312349e-01,
            -3.45470524e00,
            7.23897219e-01,
            3.49540949e00,
            -1.54396147e-01,
            1.96257377e00,
            -8.16661939e-02,
            -1.42608774e00,
            -6.39269233e-01,
            7.82996774e-01,
            2.48106170e00,
            9.45179760e-01,
            -8.31814110e-01,
            -7.13138878e-01,
            -1.56903923e00,
            1.44644022e00,
            -1.24463284e00,
            -5.90117991e-01,
            -1.30865097e00,
            1.70658243e00,
            3.14512819e-01,
            5.01549184e-01,
            -3.24578106e-01,
            2.81532764e-01,
            6.94498479e-01,
            1.65341794e00,
            -1.78533092e-01,
            -1.36791408e00,
            -3.05325389e-01,
            1.57340133e00,
            -8.41358781e-01,
            5.52713513e-01,
            -7.22983599e-01,
            4.10806626e-01,
            -5.17388061e-02,
            1.05758071e00,
            2.37797365e-01,
            -8.51634622e-01,
            -1.79594696e-01,
            -4.38443124e-01,
            9.10361111e-02,
            1.02692962e-01,
            6.27609611e-01,
            5.56623459e-01,
            5.40035427e-01,
            1.44254386e00,
            8.21452856e-01,
            7.96434343e-01,
            -6.25197291e-01,
            3.09273601e-03,
            -6.24552667e-02,
            -1.03001225e00,
            3.47646058e-01,
            -3.60108972e-01,
            7.73691535e-01,
            -8.22658122e-01,
            -6.71157479e-01,
            9.70521867e-01,
            2.73865640e-01,
            1.69602585e00,
            5.74894428e-01,
            5.25952458e-01,
            -2.73797333e-01,
            2.24092394e-01,
            -3.01282465e-01,
            -8.98015559e-01,
            -3.54814857e-01,
            -5.35844207e-01,
            -2.62837589e-01,
            7.90212154e-01,
            1.64234906e-01,
            1.01651788e00,
            1.22546232e00,
            -3.33948851e-01,
            -4.89927202e-01,
            -1.12350926e-01,
            -1.36075035e-01,
            -9.49754834e-01,
            -5.68806455e-02,
            2.42536068e-01,
            -2.81865031e-01,
            5.53327501e-02,
            7.90774226e-01,
            2.38684490e-02,
            -9.46886778e-01,
            5.67425728e-01,
            1.11705333e-01,
            -8.51398855e-02,
            -3.33825350e-01,
            2.33040452e-01,
            -4.90594149e-01,
            6.75024092e-03,
            3.73918623e-01,
            -3.34260643e-01,
            -7.60734856e-01,
            -5.63092679e-02,
            4.10971254e-01,
            -2.63164580e-01,
            8.54819715e-02,
            -4.20097411e-02,
            -9.82390791e-02,
            3.80521566e-01,
            2.33330190e-01,
            4.47722435e-01,
            -3.42616737e-02,
            -5.51659703e-01,
            5.68716228e-01,
            -2.82406271e-01,
            6.78738177e-01,
            -8.50788295e-01,
            1.21547759e-01,
            -3.42155367e-01,
            -5.10491610e-01,
            -6.96370900e-01,
            2.27460936e-02,
            -3.87611985e-01,
            -1.09960282e00,
        ]
    )

    assert np.allclose(vecs[0], expected, atol=1e-5)
